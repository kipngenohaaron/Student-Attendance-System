{% extends 'hod_template/base_template.html' %}

{% block page_title %}
  Add Staff
{% endblock page_title %}

{% block main_content %}
{% load static %}

<section class="content">
  <div class="container-fluid">

    <div class="row justify-content-center">
      <div class="col-md-8">
        <!-- Add Staff Card -->
        <div class="card shadow-lg border-0 rounded-3">
          <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h3 class="card-title mb-0"><i class="fas fa-user-plus"></i> Add Staff</h3>
            <a href="{% url 'manage_staff' %}" class="btn btn-sm btn-light text-primary fw-bold">
              <i class="fas fa-arrow-left"></i> Back
            </a>
          </div>

          <form role="form" method="POST" action="{% url 'add_staff_save' %}" class="p-3">
            {% csrf_token %}

            <!-- Alerts -->
            {% if messages %}
              <div class="mb-3">
                {% for message in messages %}
                  <div class="alert alert-{{ message.tags }} alert-dismissible fade show shadow-sm" role="alert">
                    {{ message }}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                {% endfor %}
              </div>
            {% endif %}

            <div class="card-body">
              <div class="form-group mb-3">
                <label for="id_email" class="fw-bold"><i class="fas fa-envelope"></i> Email Address</label>
                <input type="email" class="form-control" name="email" placeholder="Enter email" id="id_email" required>
              </div>

              <div class="form-group mb-3">
                <label for="id_username" class="fw-bold"><i class="fas fa-user"></i> Username</label>
                <input type="text" class="form-control" name="username" placeholder="Username" id="id_username" required>
              </div>

              <div class="form-group mb-3">
                <label for="password" class="fw-bold"><i class="fas fa-lock"></i> Password</label>
                <input type="password" class="form-control" name="password" placeholder="Password" required>
              </div>

              <div class="form-group mb-3">
                <label for="first_name" class="fw-bold"><i class="fas fa-id-card"></i> First Name</label>
                <input type="text" class="form-control" name="first_name" placeholder="First Name" required>
              </div>

              <div class="form-group mb-3">
                <label for="last_name" class="fw-bold"><i class="fas fa-id-card-alt"></i> Last Name</label>
                <input type="text" class="form-control" name="last_name" placeholder="Last Name" required>
              </div>

              <div class="form-group mb-3">
                <label for="address" class="fw-bold"><i class="fas fa-map-marker-alt"></i> Address</label>
                <textarea class="form-control" name="address" placeholder="Enter address" rows="3" required></textarea>
              </div>
            </div>

            <div class="card-footer text-end bg-light">
              <button type="submit" class="btn btn-success shadow-sm px-4">
                <i class="fas fa-save"></i> Add Staff
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

  </div>
</section>
{% endblock main_content %}

{% block custom_js %}
<script>
$(document).ready(function(){
  // Email availability check
  $("#id_email").keyup(function(){
    var email = $(this).val();
    if(email !== ""){
      $.ajax({
        url : '{% url "check_email_exist" %}',
        type : 'POST',
        data : {email: email, csrfmiddlewaretoken: '{{ csrf_token }}'},
        success: function(response){
          $(".email_error").remove();
          let msg = response === "True" 
            ? "<span class='email_error text-danger fw-bold ms-2'>Email Not Available</span>" 
            : "<span class='email_error text-success fw-bold ms-2'>Email Available</span>";
          $(msg).insertAfter("#id_email");
        },
        error: function(){ console.log("Error checking email."); }
      });
    } else { $(".email_error").remove(); }
  });

  // Username availability check
  $("#id_username").keyup(function(){
    var username = $(this).val();
    if(username !== ""){
      $.ajax({
        url : '{% url "check_username_exist" %}',
        type : 'POST',
        data : {username: username, csrfmiddlewaretoken: '{{ csrf_token }}'},
        success: function(response){
          $(".username_error").remove();
          let msg = response === "True" 
            ? "<span class='username_error text-danger fw-bold ms-2'>Username Not Available</span>" 
            : "<span class='username_error text-success fw-bold ms-2'>Username Available</span>";
          $(msg).insertAfter("#id_username");
        },
        error: function(){ console.log("Error checking username."); }
      });
    } else { $(".username_error").remove(); }
  });
});
</script>
{% endblock custom_js %}
